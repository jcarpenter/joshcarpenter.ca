@use 'mixins-and-functions' as *;

/* 
========================================================
POST-SPECIFIC STYLES
========================================================
*/

article {
	--max-post-width: 50rem;
}

// -------------- Header - Shared -------------- //

article header {
	position: relative;
	padding-top: 2rem;
	margin-bottom: 1rem;
}

article h1 {
	vertical-align: baseline;
	letter-spacing: -0.01em;
	color: accent(1);
	font-weight: 400;
	max-width: 34ch;
	margin-bottom: 1rem;
	max-width: 34ch;

	@include baselineShiftTypography($fontSize: 1.6rem, $lineHeight: 2rem);

	@include medium-screen {
		font-weight: 400;
		@include baselineShiftTypography($fontSize: 2rem, $lineHeight: 3rem);
	}
}

article header #front-matter #details {
	flex: 0 0 content;
	white-space: nowrap;

	> * {
		display: block;
	}

	.author {
		color: onBackground(var(--base-text-alpha));
		text-decoration-color: transparent;
		text-underline-offset: 0.15em;
		&:hover {
			color: onBackground(0.8);
			text-decoration-color: onBackground(0.8);
		}
	}

	time {
		color: onBackground(var(--base-text-alpha));
	}

	#tags {
		margin: 0;
		padding: 0;
		display: flex;
		color: onBackground(0.5);
		margin-right: 0.5rem;
		margin-bottom: 0.5rem;

		li {
			list-style: none;
			display: inline;
			flex: 0 0 auto;
			margin: 0;
			padding: 0;
		}

		li + li::before {
			content: ', ';
		}
	}
}

// -------------- Header - Large -------------- //

article.large {
	header {
		margin-bottom: 4rem;
	}

	h1 {
		margin-bottom: 3rem;
	}

	#front-matter {
		padding-bottom: 3rem;
		border-bottom: 2px solid accent(0.8);
	}

	#front-matter .wrapper {
		max-width: var(--max-post-width);
	}

	#front-matter #details {
		display: grid;
		grid-template-columns: repeat(2, fit-content(2ch));
		column-gap: 1.5rem;

		#photo {
			grid-row-end: span 2;
			border-radius: 50%;
			width: 3.5rem;
			height: 3.5rem;
			overflow: hidden;
			img {
				background-color: accent(0.1);
			}
		}

		.author,
		time {
			// grid-column: 2;
		}
	}

	#front-matter #summary {
		position: relative;
		margin-right: 1rem;
		margin-bottom: 2rem;
		filter: brightness(1.2);

		&::before {
			content: '';
			min-width: 2px;
			max-width: 0.2em;
			position: absolute;
			height: 100%;
			border-radius: 2px;
			box-sizing: content-box;
			top: 0.5rem;
			// Reduce height so this visible box only extends as
			// far as the baseline of the last line. If we don't
			// do this, it extends to descender and bottom padding.
			height: calc(100% - 1rem);

			@include light {
				background-color: accent(1);
			}
			@include dark {
				background-color: accent(1);
			}
		}

		p {
			line-height: 2.25rem;
			max-width: 52ch;
			padding-top: 0 !important;
			padding-left: 1.5rem;
			margin: 0;
		}
	}
}

// -------------- Header - Compact -------------- //

article.compact {
	h1 {
		margin-bottom: 1rem;
	}

	#front-matter {
		margin: 2rem 0 0;
		padding: 1.5rem 0 2rem;

		@include small-screen {
			padding-bottom: 3rem;
		}

		border-top-width: 1px;
		border-top-style: solid;
		border-top-color: onBackground(0.2);
	}

	#front-matter .wrapper {
		max-width: var(--max-post-width);
		display: flex;
		flex-wrap: wrap;
		overflow: hidden;
		row-gap: 1rem;
		column-gap: 4rem;
		align-items: start;
	}

	#front-matter #details {
		flex: 0 0 content;
		white-space: nowrap;

		> * {
			display: block;
		}

		// .author {
		// 	color: onBackground(0.5);
		// 	text-decoration-color: transparent;
		// 	text-underline-offset: 0.15em;
		// 	&:hover {
		// 		color: onBackground(0.8);
		// 		text-decoration-color: onBackground(0.8);
		// 	}
		// }

		// time {
		// 	color: onBackground(0.5);
		// }

		// #tags {
		// 	margin: 0;
		// 	padding: 0;
		// 	display: flex;
		// 	color: onBackground(0.5);
		// 	margin-right: 0.5rem;
		// 	margin-bottom: 0.5rem;

		// 	li {
		// 		list-style: none;
		// 		display: inline;
		// 		flex: 0 0 auto;
		// 		margin: 0;
		// 		padding: 0;
		// 	}

		// 	li + li::before {
		// 		content: ", ";
		// 	}
		// }
	}

	#front-matter #summary {
		flex: 1 0 40ex;
		margin: 0;
		// padding: 0;

		p {
			margin-bottom: 0rem;
			color: onBackground(0.7);
			font-weight: 500;
		}
	}
}

// -------------- Body -------------- //

// Consistent margin-bottom for top-level
// children (sections and divs). More margin
// for .large posts.
article.large #body > * {
	margin-bottom: calc(var(--large-margin) + 1rem) !important;
	&.splash {
		margin-bottom: var(--large-margin) !important;
	}
}
article.compact #body > * {
	margin-bottom: var(--large-margin) !important;
}

// Borders on top of top-level sections
#body > section {
	border-top-width: 1px;
	border-top-style: solid;
	border-top-color: sectionDivider(1);
	transition: border-color 0.2s;
}

#body section:focus-visible { 
	outline: none; 
}

// Consistent max-width on children of top-level sections
#body > section > * {
	max-width: var(--max-post-width);
}

// For first section of the #body:
// - Don't apply top border to first section
// - Hide h2 if it has .hide class
#body > section:first-of-type {
	border-top: none;
	h2.hide {
		display: none;
	}
}


/* -------------- H2 -------------- */

.copy h2 {
	color: accent(1);
	font-weight: 500;
	margin-top: 0;
	margin-bottom: 1rem;

	// Hide link underlines
	a {
		color: inherit;
		text-decoration-color: transparent;
	}

	a:hover {
		color: inherit;
		text-decoration-color: transparent;
	}
}

// Add ## before h2:
// - Larger screens only (no room on smaller displays)
@include small-screen {
	.copy h2 a {
		position: relative;

		&::before {
			content: '##';
			font-weight: 300;
			font-size: 0.9em;
			color: accent(0.2);
			left: -0.5rem;
			transform: translateX(-100%);
			position: absolute;
			transition: color 0.15s;
		}

		&:hover::before {
			color: accent(1);
		}
	}
}

// Larger typography on .large articles
// Smaller on .compact
article.large .copy h2 {
	@include baselineShiftTypography($fontSize: 1.6rem, $lineHeight: 2.5rem, $paddingTop: 2rem);
}

article.compact .copy h2 {
	@include baselineShiftTypography($fontSize: 1.333rem, $lineHeight: 2rem, $paddingTop: 2rem);
}

/* -------------- H3 -------------- */

.copy h3 {
	color: onBackground(1);
	font-weight: 500;
	margin-bottom: 1rem;
	@include baselineShiftTypography;

	// Hide link underlines
	a {
		color: inherit;
		text-decoration-color: transparent;
	}

	// Override default a hover styles.
	// We don't want underline or color change.
	a:hover {
		color: inherit;
		text-decoration-color: transparent;
	}
}

// In article.large h3's:
// - Top padding
// - Brighten
// - Add ### prefix (on >large screens)
article.large .copy h3 {
	
	margin-top: 2rem;
	filter: brightness(1.1);
	
	@include large-screen {
		position: relative;
	
		&::before {
			content: '###';
			font-weight: 300;
			font-size: 0.9em;
			color: onBackground(0.3);
			left: -0.5rem;
			transform: translateX(-100%);
			position: absolute;
			transition: color 0.15s;
		}
	
		&:hover::before {
			color: onBackground(1);
		}
	}
}

/* -------------- Aside -------------- */

.caution {
	border-radius: var(--media-border-radius);
	border-left: 0.2rem solid caution(1);
	padding: 2rem 2rem;

	@include light {
		background-color: caution(0.1);
	}
	
	@include dark {
		background-color: caution(0.1);
	}
}

.caution > *:first-child::before {
	content: 'Caution';
	@include monoFont;
	border-radius: 0.2em;
	// Push vertical alignment up a few px.
	// Code text is bit smaller than surrounding,
	// So we need to vertically center it.
	line-height: 0;
	vertical-align: 0.05em;
	padding: 0.075em 0.25em 0.15em;
	font-size: 0.85em;
	margin-right: 0.5em;
	
	@include light {
		color: white;
		background-color: caution(1);
	}
	
	@include dark {
		filter: brightness(0.8);
		color: foreground(1);
		background-color: caution(0.6);
	}
}

.caution > * {
	@include baselineShiftTypography($fontSize: 1.33rem, $lineHeight: 2rem);
	display: inline;

	@include light { 
		color: caution(1) !important;
	}

	@include dark {
		color: caution(0.8) !important;
		filter: brightness(1.4);
	}
}

.caution p > a {
	color: caution(1) !important;

}

// -------------- Other section -------------- //

#footnotes,
#about-the-author {
	margin-top: var(--large-margin);
}
